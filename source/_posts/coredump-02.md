---
title: 使用gdb解析core dump-解析篇
date: '2015-06-11'
description:
categories:
- coredump
tags:
- coredump
---

### Core dump如何解析？ 

`man 7 signal`的结果给了我们一些提示，不妨我们来验证一下。

### SIGQUIT信号下的Core dump解析

`SIGABRT `信号表示用户在终端上按了退出键（一般采用Ctrl-\）；使用之前用的helloworld程序，运行以后输入Ctrl+\；

```
archerding@ubuntu:~$ ./hello 
Hello World!
Hello World!
Hello World!
Hello World!
^\Quit (core dumped)
archerding@ubuntu:~$ ls /tmp/core/
core-hello.2213
```

接下来开始解析这个core文件;错误提示非常明显`Program terminated with signal SIGQUIT, Quit.`;

```
archerding@ubuntu:/tmp/core$ gdb ~/hello core-hello.2213
GNU gdb (Ubuntu 7.9-1ubuntu1) 7.9
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /home/archerding/hello...(no debugging symbols found)...done.
[New LWP 2213]
Core was generated by `./hello'.
Program terminated with signal SIGQUIT, Quit.
#0  0x00007f4e7d2a2c30 in __nanosleep_nocancel ()
    at ../sysdeps/unix/syscall-template.S:81
81	../sysdeps/unix/syscall-template.S: No such file or directory.
(gdb) 
```

### SIGABRT信号下的Core dump解析

`SIGABRT `信号表示调用abort函数；编写新的测试程序，尝试调用一下`abort()`函数验证一下；

```
#include <stdlib.h>

int main()
{
    abort();
    return 0;
}
```

编译执行，果真产生了core文件；

```
archerding@ubuntu:~$ gcc sigabort.c -o sigabort
archerding@ubuntu:~$ ./sigabort 
Aborted (core dumped)
archerding@ubuntu:~$ ls /tmp/core/
core-sigabort.2594
```

接下来开始解析这个core文件;错误提示非常明显`Program terminated with signal SIGABRT, Aborted.`; 
使用`bt`打印栈信息，定位错误调用了`abort()`函数。

```
archerding@ubuntu:/tmp/core$ gdb ~/sigabort core-sigabort.2594
GNU gdb (Ubuntu 7.9-1ubuntu1) 7.9
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /home/archerding/sigabort...(no debugging symbols found)...done.

warning: exec file is newer than core file.
[New LWP 2594]
Core was generated by `./sigabort'.
Program terminated with signal SIGABRT, Aborted.
#0  0x00007ff6657bd267 in __GI_raise (sig=sig@entry=6)
    at ../sysdeps/unix/sysv/linux/raise.c:55
55	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
(gdb) bt
#0  0x00007ff6657bd267 in __GI_raise (sig=sig@entry=6)
    at ../sysdeps/unix/sysv/linux/raise.c:55
#1  0x00007ff6657beeca in __GI_abort () at abort.c:89
#2  0x000000000040053f in main ()
Print backtrace of all stack frames, or innermost COUNT frames.
With a negative argument, print outermost -COUNT frames.
Use of the 'full' qualifier also prints the values of the local variables.
Use of the 'no-filters' qualifier prohibits frame filters from executing
on this backtrace.

(gdb) 
```

### SIGFPE信号下的Core dump解析

`SIGFPE`信号表示一个算术运算异常，例如除以0，浮点溢出等；编写新的测试程序，尝试产生`SIGFPE`信号；

```
#include <stdlib.h>

int calc(int num)
{
    int divider = 0;
    int result = 0;
    result = num / divider;
    return result;
}

int main()
{
    calc(10);
    return 0;
}
```

编译执行，果真产生了core文件；

```
archerding@ubuntu:~$ gcc sigfpe.c -o sigfpe
archerding@ubuntu:~$ ./sigfpe 
Floating point exception (core dumped)
archerding@ubuntu:~$ ls /tmp/core/
core-sigfpe.2722
```

接下来开始解析这个core文件;错误提示`Program terminated with signal SIGFPE, Arithmetic exception.`; 
使用`bt`打印栈信息，定位错误函数是`calc ()`函数；
使用`i r`打印寄存器信息，发现在调用到汇编指令地址`rip            0x40050f	0x40050f <calc+25>`时出现异常；
使用`disas`反汇编问题函数，发现在调用`idivl  -0x8(%rbp)`时出错，该汇编指令是做除法运算；
使用`x $rbp-0x8`打印除数，发现除数为0。

```
archerding@ubuntu:/tmp/core$ gdb ~/sigfpe core-sigfpe.2722
GNU gdb (Ubuntu 7.9-1ubuntu1) 7.9
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /home/archerding/sigfpe...(no debugging symbols found)...done.
[New LWP 2722]
Core was generated by `./sigfpe'.
Program terminated with signal SIGFPE, Arithmetic exception.
#0  0x000000000040050f in calc ()
(gdb) bt
#0  0x000000000040050f in calc ()
#1  0x0000000000400528 in main ()
(gdb) i r
rax            0xa	10
rbx            0x0	0
rcx            0x0	0
rdx            0x0	0
rsi            0x7ffcb45b2198	140723334357400
rdi            0xa	10
rbp            0x7ffcb45b20a0	0x7ffcb45b20a0
rsp            0x7ffcb45b20a0	0x7ffcb45b20a0
r8             0x7ff8d052ddd0	140706623708624
r9             0x7ff8d05489d0	140706623818192
r10            0x833	2099
r11            0x7ff8d0188950	140706619885904
r12            0x400400	4195328
r13            0x7ffcb45b2190	140723334357392
r14            0x0	0
r15            0x0	0
rip            0x40050f	0x40050f <calc+25>
eflags         0x10246	[ PF ZF IF RF ]
cs             0x33	51
ss             0x2b	43
ds             0x0	0
es             0x0	0
fs             0x0	0
---Type <return> to continue, or q <return> to quit---
gs             0x0	0
(gdb) disas
Dump of assembler code for function calc:
   0x00000000004004f6 <+0>:	push   %rbp
   0x00000000004004f7 <+1>:	mov    %rsp,%rbp
   0x00000000004004fa <+4>:	mov    %edi,-0x14(%rbp)
   0x00000000004004fd <+7>:	movl   $0x0,-0x8(%rbp)
   0x0000000000400504 <+14>:	movl   $0x0,-0x4(%rbp)
   0x000000000040050b <+21>:	mov    -0x14(%rbp),%eax
   0x000000000040050e <+24>:	cltd   
=> 0x000000000040050f <+25>:	idivl  -0x8(%rbp)
   0x0000000000400512 <+28>:	mov    %eax,-0x4(%rbp)
   0x0000000000400515 <+31>:	mov    -0x4(%rbp),%eax
   0x0000000000400518 <+34>:	pop    %rbp
   0x0000000000400519 <+35>:	retq   
End of assembler dump.
(gdb) x $rbp-0x8
0x7ffcb45b2098:	0x00000000
```


### SIGSEGV信号下的Core dump解析

`SIGSEGV `信号表示进程进行了一次无效的存储访问，EGV表示段违例（segmentation violation）；编写新的测试程序，尝试产生`SIGSEGV  `信号；

```
#include <stdlib.h>

const char *str = "hello World!";
 
void mod_str()
{
    str[0] = 'H';
}

int main()
{
    mod_str();
    return 0;
}
```

编译执行，果真产生了core文件；

```
archerding@ubuntu:~$ gcc sigsegv.c -o sigsegv
archerding@ubuntu:~$ ./sigsegv 
Segmentation fault (core dumped)
archerding@ubuntu:~$ ls /tmp/core/
core-sigsegv.2856
```

接下来开始解析这个core文件;错误提示`Program terminated with signal SIGSEGV, Segmentation fault.`; 
使用`bt`打印栈信息，定位错误函数是`mod_str()`函数；
使用`i r`打印寄存器信息，发现在调用到汇编指令地址`rip           0x400509	0x400509 <mod_str+19>`时出现异常；
使用`disas`反汇编问题函数，发现在调用`movb   $0x48,(%rax)`时出错；
使用`x /16s $rax`打印错误地址指向的内存，发现改地址是`0x4005b4 `指向了字符串`hello World!`;
使用`info proc map`查看内存映射,处于第一个区域内。

```
archerding@ubuntu:/tmp/core$ gdb ~/sigsegv core-sigsegv.2856
GNU gdb (Ubuntu 7.9-1ubuntu1) 7.9
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /home/archerding/sigsegv...(no debugging symbols found)...done.
[New LWP 2856]
Core was generated by `./sigsegv'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000000000400509 in mod_str ()
(gdb) bt
#0  0x0000000000400509 in mod_str ()
#1  0x000000000040051c in main ()
(gdb) i r
rax            0x4005b4	4195764
rbx            0x0	0
rcx            0x0	0
rdx            0x7fff284dc488	140733869573256
rsi            0x7fff284dc478	140733869573240
rdi            0x1	1
rbp            0x7fff284dc380	0x7fff284dc380
rsp            0x7fff284dc380	0x7fff284dc380
r8             0x7f590a295dd0	140020399300048
r9             0x7f590a2b09d0	140020399409616
r10            0x833	2099
r11            0x7f5909ef0950	140020395477328
r12            0x400400	4195328
r13            0x7fff284dc470	140733869573232
r14            0x0	0
r15            0x0	0
rip            0x400509	0x400509 <mod_str+19>
eflags         0x10246	[ PF ZF IF RF ]
cs             0x33	51
ss             0x2b	43
ds             0x0	0
es             0x0	0
fs             0x0	0
---Type <return> to continue, or q <return> to quit---
gs             0x0	0
(gdb) disas
Dump of assembler code for function mod_str:
   0x00000000004004f6 <+0>:	push   %rbp
   0x00000000004004f7 <+1>:	mov    %rsp,%rbp
   0x00000000004004fa <+4>:	mov    0x200b37(%rip),%rax        # 0x601038 <str>
   0x0000000000400501 <+11>:	mov    %rax,-0x8(%rbp)
   0x0000000000400505 <+15>:	mov    -0x8(%rbp),%rax
=> 0x0000000000400509 <+19>:	movb   $0x48,(%rax)
   0x000000000040050c <+22>:	pop    %rbp
   0x000000000040050d <+23>:	retq   
End of assembler dump.
(gdb) x /16s $rax
0x4005b4:	"hello World!"
0x4005c1:	""
0x4005c2:	""
0x4005c3:	""
0x4005c4:	"\001\033\003;8"
0x4005ca:	""
0x4005cb:	""
0x4005cc:	"\006"
0x4005ce:	""
0x4005cf:	""
0x4005d0:	"\f\376\377\377\204"
0x4005d6:	""
0x4005d7:	""
0x4005d8:	"<\376\377\377T"
0x4005de:	""
0x4005df:	""
(gdb) info proc map
Mapped address spaces:

          Start Addr           End Addr       Size     Offset objfile
            0x400000           0x401000     0x1000        0x0 /home/archerding/sigsegv
            0x600000           0x601000     0x1000        0x0 /home/archerding/sigsegv
            0x601000           0x602000     0x1000     0x1000 /home/archerding/sigsegv
      0x7f5909ed0000     0x7f590a090000   0x1c0000        0x0 /lib/x86_64-linux-gnu/libc-2.21.so
      0x7f590a090000     0x7f590a290000   0x200000   0x1c0000 /lib/x86_64-linux-gnu/libc-2.21.so
      0x7f590a290000     0x7f590a294000     0x4000   0x1c0000 /lib/x86_64-linux-gnu/libc-2.21.so
      0x7f590a294000     0x7f590a296000     0x2000   0x1c4000 /lib/x86_64-linux-gnu/libc-2.21.so
      0x7f590a2a0000     0x7f590a2c4000    0x24000        0x0 /lib/x86_64-linux-gnu/ld-2.21.so
      0x7f590a4c3000     0x7f590a4c4000     0x1000    0x23000 /lib/x86_64-linux-gnu/ld-2.21.so
(gdb) 
```

接下来使用`objdump -t ~/sigsegv`进一步确认，发现在修改` .rodata`段时出错，该段用来保存常量。

```
archerding@ubuntu:/tmp/core$ objdump -t ~/sigsegv

/home/archerding/sigsegv:     file format elf64-x86-64

SYMBOL TABLE:
0000000000400238 l    d  .interp	0000000000000000              .interp
0000000000400254 l    d  .note.ABI-tag	0000000000000000              .note.ABI-tag
0000000000400274 l    d  .note.gnu.build-id	0000000000000000              .note.gnu.build-id
0000000000400298 l    d  .gnu.hash	0000000000000000              .gnu.hash
00000000004002b8 l    d  .dynsym	0000000000000000              .dynsym
0000000000400300 l    d  .dynstr	0000000000000000              .dynstr
0000000000400338 l    d  .gnu.version	0000000000000000              .gnu.version
0000000000400340 l    d  .gnu.version_r	0000000000000000              .gnu.version_r
0000000000400360 l    d  .rela.dyn	0000000000000000              .rela.dyn
0000000000400378 l    d  .rela.plt	0000000000000000              .rela.plt
00000000004003a8 l    d  .init	0000000000000000              .init
00000000004003d0 l    d  .plt	0000000000000000              .plt
0000000000400400 l    d  .text	0000000000000000              .text
00000000004005a4 l    d  .fini	0000000000000000              .fini
00000000004005b0 l    d  .rodata	0000000000000000              .rodata
00000000004005c4 l    d  .eh_frame_hdr	0000000000000000              .eh_frame_hdr
0000000000400600 l    d  .eh_frame	0000000000000000              .eh_frame
0000000000600e10 l    d  .init_array	0000000000000000              .init_array
0000000000600e18 l    d  .fini_array	0000000000000000              .fini_array
0000000000600e20 l    d  .jcr	0000000000000000              .jcr
0000000000600e28 l    d  .dynamic	0000000000000000              .dynamic
0000000000600ff8 l    d  .got	0000000000000000              .got
0000000000601000 l    d  .got.plt	0000000000000000              .got.plt
0000000000601028 l    d  .data	0000000000000000              .data
0000000000601040 l    d  .bss	0000000000000000              .bss
0000000000000000 l    d  .comment	0000000000000000              .comment
0000000000000000 l    df *ABS*	0000000000000000              crtstuff.c
0000000000600e20 l     O .jcr	0000000000000000              __JCR_LIST__
0000000000400430 l     F .text	0000000000000000              deregister_tm_clones
0000000000400470 l     F .text	0000000000000000              register_tm_clones
00000000004004b0 l     F .text	0000000000000000              __do_global_dtors_aux
0000000000601040 l     O .bss	0000000000000001              completed.7291
0000000000600e18 l     O .fini_array	0000000000000000              __do_global_dtors_aux_fini_array_entry
00000000004004d0 l     F .text	0000000000000000              frame_dummy
0000000000600e10 l     O .init_array	0000000000000000              __frame_dummy_init_array_entry
0000000000000000 l    df *ABS*	0000000000000000              sigsegv.c
0000000000000000 l    df *ABS*	0000000000000000              crtstuff.c
0000000000400710 l     O .eh_frame	0000000000000000              __FRAME_END__
0000000000600e20 l     O .jcr	0000000000000000              __JCR_END__
0000000000000000 l    df *ABS*	0000000000000000              
0000000000600e18 l       .init_array	0000000000000000              __init_array_end
0000000000600e28 l     O .dynamic	0000000000000000              _DYNAMIC
0000000000600e10 l       .init_array	0000000000000000              __init_array_start
0000000000601000 l     O .got.plt	0000000000000000              _GLOBAL_OFFSET_TABLE_
00000000004005a0 g     F .text	0000000000000002              __libc_csu_fini
0000000000000000  w      *UND*	0000000000000000              _ITM_deregisterTMCloneTable
0000000000601028  w      .data	0000000000000000              data_start
0000000000601040 g       .data	0000000000000000              _edata
00000000004005a4 g     F .fini	0000000000000000              _fini
0000000000000000       F *UND*	0000000000000000              __libc_start_main@@GLIBC_2.2.5
0000000000601028 g       .data	0000000000000000              __data_start
0000000000000000  w      *UND*	0000000000000000              __gmon_start__
0000000000601030 g     O .data	0000000000000000              .hidden __dso_handle
00000000004004f6 g     F .text	0000000000000018              mod_str
00000000004005b0 g     O .rodata	0000000000000004              _IO_stdin_used
0000000000400530 g     F .text	0000000000000065              __libc_csu_init
0000000000601048 g       .bss	0000000000000000              _end
0000000000400400 g     F .text	000000000000002a              _start
0000000000601038 g     O .data	0000000000000008              str
0000000000601040 g       .bss	0000000000000000              __bss_start
000000000040050e g     F .text	0000000000000015              main
0000000000000000  w      *UND*	0000000000000000              _Jv_RegisterClasses
0000000000601040 g     O .data	0000000000000000              .hidden __TMC_END__
0000000000000000  w      *UND*	0000000000000000              _ITM_registerTMCloneTable
00000000004003a8 g     F .init	0000000000000000              _init
```